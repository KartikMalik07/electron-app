<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêò Airavat v1.0.0 - AI Elephant Identification</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.1em;
            color: #555;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-tab:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card h3 {
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .system-requirements {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .requirement-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #fff;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: rgba(118, 75, 162, 0.1);
        }

        .upload-area.dragover {
            border-color: #4facfe;
            background: rgba(79, 172, 254, 0.2);
            transform: scale(1.02);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .progress-container {
            margin: 20px 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .results-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .result-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .confidence-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .confidence-high {
            background: #d4edda;
            color: #155724;
        }

        .confidence-medium {
            background: #fff3cd;
            color: #856404;
        }

        .confidence-low {
            background: #f8d7da;
            color: #721c24;
        }

        .settings-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .setting-item {
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .slider {
            width: 200px;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }

        .model-info {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #28a745;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
        }

        .status-offline {
            background: #dc3545;
        }

        .system-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .info-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .info-card h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .model-tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
        }

        .model-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .model-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .hidden {
            display: none !important;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #dc3545;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .batch-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêò Airavat</h1>
            <p>AI-powered Individual Asian Elephant Identification using Siamese Neural Networks and YOLOv8 ‚Ä¢ Version 1.0.0</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('home')">üè† Home</button>
            <button class="nav-tab" onclick="showTab('siamese')">üîç Siamese Network</button>
            <button class="nav-tab" onclick="showTab('yolo')">üéØ YOLOv8 Detection</button>
            <button class="nav-tab" onclick="showTab('batch')">üìÇ Batch Processing</button>
        </div>

        <!-- Home Tab -->
        <div id="home" class="tab-content active">
            <h2>Welcome to Airavat</h2>

            <div class="feature-grid">
                <div class="feature-card">
                    <h3>üß† Siamese Neural Network</h3>
                    <p>Advanced similarity learning for individual elephant identification using ear pattern recognition with EfficientNet backbone.</p>
                    <ul style="margin-top: 15px; line-height: 1.6;">
                        <li>Single image identification</li>
                        <li>Confidence scoring</li>
                        <li>Feature-by-feature analysis</li>
                        <li>266 elephant dataset comparison</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h3>üéØ YOLOv8 Detection</h3>
                    <p>Real-time elephant detection and localization using state-of-the-art object detection technology.</p>
                    <ul style="margin-top: 15px; line-height: 1.6;">
                        <li>Fast object detection</li>
                        <li>Bounding box visualization</li>
                        <li>Multi-elephant detection</li>
                        <li>Real-time processing</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h3>üìä Batch Processing</h3>
                    <p>Process large datasets efficiently with automated grouping and detailed analytics.</p>
                    <ul style="margin-top: 15px; line-height: 1.6;">
                        <li>Process up to 200GB of images</li>
                        <li>Automatic similarity grouping</li>
                        <li>Detailed summary reports</li>
                        <li>Cross-model comparison</li>
                    </ul>
                </div>
            </div>

            <div class="system-requirements">
                <h3>üíª System Requirements</h3>
                <div class="requirements-grid">
                    <div class="requirement-item">
                        <h4>Minimum Requirements</h4>
                        <p>‚Ä¢ 8GB RAM<br>‚Ä¢ Python 3.8-3.11<br>‚Ä¢ 10GB storage<br>‚Ä¢ Dual-core CPU</p>
                    </div>
                    <div class="requirement-item">
                        <h4>Recommended</h4>
                        <p>‚Ä¢ 16GB+ RAM<br>‚Ä¢ NVIDIA GPU (CUDA)<br>‚Ä¢ 50GB+ storage<br>‚Ä¢ Quad-core CPU</p>
                    </div>
                    <div class="requirement-item">
                        <h4>Dependencies</h4>
                        <p>‚Ä¢ PyTorch<br>‚Ä¢ OpenCV<br>‚Ä¢ Ultralytics<br>‚Ä¢ Node.js 16+</p>
                    </div>
                </div>
            </div>

            <div class="system-info" id="systemInfo">
                <!-- System info will be populated by JavaScript -->
            </div>

            <div class="model-info">
                <h3>üìà Model Information</h3>
                <div id="modelStatus">
                    <p><span class="status-indicator status-offline"></span>Connecting to backend...</p>
                </div>
            </div>
        </div>

        <!-- Siamese Network Tab -->
        <div id="siamese" class="tab-content">
            <h2>üîç Siamese Neural Network Identification</h2>

            <div class="upload-area" id="siameseUpload" onclick="selectSiameseImage()">
                <h3>üì∏ Upload Elephant Image</h3>
                <p>Click here or drag & drop an elephant image for identification</p>
                <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                    Supported formats: JPG, PNG, BMP, TIFF
                </p>
            </div>

            <div class="settings-panel">
                <h4>‚öôÔ∏è Identification Settings</h4>
                <div class="setting-item">
                    <label>Similarity Threshold:</label>
                    <div>
                        <input type="range" id="siameseThreshold" class="slider" min="0.5" max="0.95" step="0.05" value="0.85">
                        <span id="siameseThresholdValue">0.85</span>
                    </div>
                </div>
                <div class="setting-item">
                    <label>Top Matches to Show:</label>
                    <select id="siameseTopK" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                        <option value="5">Top 5</option>
                        <option value="10" selected>Top 10</option>
                        <option value="15">Top 15</option>
                        <option value="20">Top 20</option>
                    </select>
                </div>
            </div>

            <div class="progress-container" id="siameseProgress">
                <div class="progress-bar">
                    <div class="progress-fill" id="siameseProgressFill"></div>
                </div>
                <p id="siameseProgressText">Processing...</p>
            </div>

            <div id="siameseResults" class="results-container" style="display: none;">
                <h4>üéØ Identification Results</h4>
                <div id="siameseResultsList"></div>
            </div>
        </div>

        <!-- YOLOv8 Tab -->
        <div id="yolo" class="tab-content">
            <h2>üéØ YOLOv8 Elephant Detection</h2>

            <div class="upload-area" id="yoloUpload" onclick="selectYoloImage()">
                <h3>üì∏ Upload Image for Detection</h3>
                <p>Click here or drag & drop an image to detect elephants</p>
                <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                    Supported formats: JPG, PNG, BMP, TIFF
                </p>
            </div>

            <div class="settings-panel">
                <h4>‚öôÔ∏è Detection Settings</h4>
                <div class="setting-item">
                    <label>Confidence Threshold:</label>
                    <div>
                        <input type="range" id="yoloConfidence" class="slider" min="0.1" max="0.9" step="0.1" value="0.5">
                        <span id="yoloConfidenceValue">0.5</span>
                    </div>
                </div>
                <div class="setting-item">
                    <label>IoU Threshold:</label>
                    <div>
                        <input type="range" id="yoloIou" class="slider" min="0.1" max="0.9" step="0.1" value="0.45">
                        <span id="yoloIouValue">0.45</span>
                    </div>
                </div>
                <div class="setting-item">
                    <label>Image Size:</label>
                    <select id="yoloImageSize" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                        <option value="640" selected>640px</option>
                        <option value="800">800px</option>
                        <option value="1024">1024px</option>
                    </select>
                </div>
            </div>

            <div class="progress-container" id="yoloProgress">
                <div class="progress-bar">
                    <div class="progress-fill" id="yoloProgressFill"></div>
                </div>
                <p id="yoloProgressText">Processing...</p>
            </div>

            <div id="yoloResults" class="results-container" style="display: none;">
                <h4>üéØ Detection Results</h4>
                <div id="yoloResultsList"></div>
            </div>
        </div>

        <!-- Batch Processing Tab -->
        <div id="batch" class="tab-content">
            <h2>üìÇ Batch Processing</h2>

            <div class="model-tabs">
                <button class="model-tab active" onclick="setBatchModel('siamese')">üîç Siamese Network</button>
                <button class="model-tab" onclick="setBatchModel('yolo')">üéØ YOLOv8 Detection</button>
                <button class="model-tab" onclick="setBatchModel('both')">üîÑ Both Models</button>
            </div>

            <div class="upload-area" onclick="selectBatchFolder()">
                <h3>üìÅ Select Folder for Batch Processing</h3>
                <p>Click here to select a folder containing elephant images</p>
                <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                    Supports nested folders ‚Ä¢ Up to 200GB ‚Ä¢ All image formats
                </p>
            </div>

            <div class="settings-panel">
                <h4>‚öôÔ∏è Batch Processing Settings</h4>
                <div class="setting-item">
                    <label>Processing Model:</label>
                    <span id="selectedBatchModel">Siamese Network</span>
                </div>
                <div class="setting-item">
                    <label>Similarity Threshold:</label>
                    <div>
                        <input type="range" id="batchThreshold" class="slider" min="0.5" max="0.95" step="0.05" value="0.85">
                        <span id="batchThresholdValue">0.85</span>
                    </div>
                </div>
                <div class="setting-item">
                    <label>Maximum Groups:</label>
                    <select id="batchMaxGroups" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                        <option value="50">50 groups</option>
                        <option value="100" selected>100 groups</option>
                        <option value="200">200 groups</option>
                        <option value="0">Unlimited</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>Output Format:</label>
                    <select id="batchOutputFormat" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                        <option value="zip" selected>ZIP Archive</option>
                        <option value="folder">Organized Folders</option>
                        <option value="csv">CSV Report Only</option>
                    </select>
                </div>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" id="startBatchBtn" onclick="startBatchProcessing()" disabled>
                    üöÄ Start Batch Processing
                </button>
                <button class="btn btn-danger" id="stopBatchBtn" onclick="stopBatchProcessing()" disabled style="margin-left: 10px;">
                    ‚èπÔ∏è Stop Processing
                </button>
            </div>

            <div class="progress-container" id="batchProgress">
                <div class="progress-bar">
                    <div class="progress-fill" id="batchProgressFill"></div>
                </div>
                <p id="batchProgressText">Waiting to start...</p>
            </div>

            <div id="batchSummary" class="batch-summary" style="display: none;">
                <h4>üìä Processing Summary</h4>
                <div class="summary-stats" id="batchStats">
                    <!-- Stats will be populated by JavaScript -->
                </div>
            </div>

            <div id="batchResults" class="results-container" style="display: none;">
                <h4>üìã Batch Results</h4>
                <div id="batchResultsList"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" id="downloadResultsBtn" onclick="downloadBatchResults()" disabled>
                        üì• Download Results
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        let currentBatchModel = 'siamese';
        let batchProcessing = false;
        let selectedFolder = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            await loadSystemInfo();
            await checkModelStatus();
            setupEventListeners();
        });

        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }

        // System Information
        async function loadSystemInfo() {
            try {
                const systemInfo = await ipcRenderer.invoke('get-system-info');
                const container = document.getElementById('systemInfo');

                container.innerHTML = `
                    <div class="info-card">
                        <h4>üíæ Memory</h4>
                        <p>${systemInfo.totalMemory} Total<br>${systemInfo.freeMemory} Available</p>
                    </div>
                    <div class="info-card">
                        <h4>üñ•Ô∏è CPU</h4>
                        <p>${systemInfo.cpuCount} Cores<br>${systemInfo.cpuModel.substring(0, 20)}...</p>
                    </div>
                    <div class="info-card">
                        <h4>üíª Platform</h4>
                        <p>${systemInfo.platform} ${systemInfo.arch}<br>Node ${systemInfo.nodeVersion}</p>
                    </div>
                    <div class="info-card">
                        <h4>‚ö° Electron</h4>
                        <p>Version ${systemInfo.electronVersion}<br>Ready for AI</p>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading system info:', error);
            }
        }

        // Model Status Check
        async function checkModelStatus() {
            try {
                const response = await fetch('http://localhost:3001/api/model-info');
                const modelInfo = await response.json();

                const statusContainer = document.getElementById('modelStatus');
                if (response.ok) {
                    statusContainer.innerHTML = `
                        <p><span class="status-indicator status-online"></span>Backend Online</p>
                        <p><strong>Siamese Model:</strong> ${modelInfo.siamese_status}</p>
                        <p><strong>YOLOv8 Model:</strong> ${modelInfo.yolo_status}</p>
                        <p><strong>Dataset:</strong> ${modelInfo.dataset_size} elephants</p>
                    `;
                } else {
                    statusContainer.innerHTML = `
                        <p><span class="status-indicator status-offline"></span>Backend Offline</p>
                        <p>Please ensure Python backend is running</p>
                    `;
                }
            } catch (error) {
                console.error('Error checking model status:', error);
                document.getElementById('modelStatus').innerHTML = `
                    <p><span class="status-indicator status-offline"></span>Connection Error</p>
                    <p>Unable to connect to Python backend</p>
                `;
            }
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Threshold sliders
            document.getElementById('siameseThreshold').addEventListener('input', function() {
                document.getElementById('siameseThresholdValue').textContent = this.value;
            });

            document.getElementById('yoloConfidence').addEventListener('input', function() {
                document.getElementById('yoloConfidenceValue').textContent = this.value;
            });

            document.getElementById('yoloIou').addEventListener('input', function() {
                document.getElementById('yoloIouValue').textContent = this.value;
            });

            document.getElementById('batchThreshold').addEventListener('input', function() {
                document.getElementById('batchThresholdValue').textContent = this.value;
            });

            // Drag and drop for upload areas
            setupDragAndDrop('siameseUpload', handleSiameseImageDrop);
            setupDragAndDrop('yoloUpload', handleYoloImageDrop);
        }

        // Drag and Drop Setup
        function setupDragAndDrop(elementId, handleDrop) {
            const element = document.getElementById(elementId);

            element.addEventListener('dragover', function(e) {
                e.preventDefault();
                element.classList.add('dragover');
            });

            element.addEventListener('dragleave', function(e) {
                e.preventDefault();
                element.classList.remove('dragover');
            });

            element.addEventListener('drop', function(e) {
                e.preventDefault();
                element.classList.remove('dragover');
                handleDrop(e.dataTransfer.files);
            });
        }

        // Siamese Network Functions
        async function selectSiameseImage() {
            const files = await ipcRenderer.invoke('select-files');
            if (files && files.length > 0) {
                processSiameseImage(files[0]);
            }
        }

        function handleSiameseImageDrop(files) {
            if (files.length > 0) {
                processSiameseImage(files[0].path);
            }
        }

        async function processSiameseImage(imagePath) {
            const progressContainer = document.getElementById('siameseProgress');
            const resultsContainer = document.getElementById('siameseResults');
            const progressFill = document.getElementById('siameseProgressFill');
            const progressText = document.getElementById('siameseProgressText');

            progressContainer.style.display = 'block';
            resultsContainer.style.display = 'none';

            try {
                // Simulate progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 10;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = `Processing image... ${progress}%`;

                    if (progress >= 90) {
                        clearInterval(progressInterval);
                    }
                }, 200);

                const formData = new FormData();
                const file = await fetch(`file://${imagePath}`).then(r => r.blob());
                formData.append('image', file);
                formData.append('threshold', document.getElementById('siameseThreshold').value);
                formData.append('top_k', document.getElementById('siameseTopK').value);

                const response = await fetch('http://localhost:3001/api/compare-dataset', {
                    method: 'POST',
                    body: formData
                });

                clearInterval(progressInterval);
                progressFill.style.width = '100%';
                progressText.textContent = 'Processing complete!';

                if (response.ok) {
                    const results = await response.json();
                    displaySiameseResults(results);
                } else {
                    throw new Error('Processing failed');
                }

                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 1000);

            } catch (error) {
                console.error('Error processing image:', error);
                progressText.textContent = 'Error processing image';
                progressContainer.style.display = 'none';
                showErrorMessage('siameseResults', 'Failed to process image. Please try again.');
            }
        }

        function displaySiameseResults(results) {
            const container = document.getElementById('siameseResultsList');
            const resultsContainer = document.getElementById('siameseResults');

            container.innerHTML = '';

            if (results.matches && results.matches.length > 0) {
                results.matches.forEach((match, index) => {
                    const confidence = parseFloat(match.confidence);
                    const confidenceClass = confidence > 0.8 ? 'confidence-high' :
                                          confidence > 0.6 ? 'confidence-medium' : 'confidence-low';

                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result-item';
                    resultDiv.innerHTML = `
                        <div style="flex: 1;">
                            <h5>Match ${index + 1}: ${match.elephant_id}</h5>
                            <p>${match.description || 'Individual elephant from dataset'}</p>
                        </div>
                        <div class="confidence-badge ${confidenceClass}">
                            ${(confidence * 100).toFixed(1)}%
                        </div>
                    `;
                    container.appendChild(resultDiv);
                });
            } else {
                container.innerHTML = '<p>No matches found above the similarity threshold.</p>';
            }

            resultsContainer.style.display = 'block';
        }

        // YOLOv8 Functions
        async function selectYoloImage() {
            const files = await ipcRenderer.invoke('select-files');
            if (files && files.length > 0) {
                processYoloImage(files[0]);
            }
        }

        function handleYoloImageDrop(files) {
            if (files.length > 0) {
                processYoloImage(files[0].path);
            }
        }

        async function processYoloImage(imagePath) {
            const progressContainer = document.getElementById('yoloProgress');
            const resultsContainer = document.getElementById('yoloResults');
            const progressFill = document.getElementById('yoloProgressFill');
            const progressText = document.getElementById('yoloProgressText');

            progressContainer.style.display = 'block';
            resultsContainer.style.display = 'none';

            try {
                // Simulate progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 15;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = `Detecting elephants... ${progress}%`;

                    if (progress >= 90) {
                        clearInterval(progressInterval);
                    }
                }, 150);

                const formData = new FormData();
                const file = await fetch(`file://${imagePath}`).then(r => r.blob());
                formData.append('image', file);
                formData.append('confidence', document.getElementById('yoloConfidence').value);
                formData.append('iou', document.getElementById('yoloIou').value);
                formData.append('image_size', document.getElementById('yoloImageSize').value);

                const response = await fetch('http://localhost:3001/api/detect-yolo', {
                    method: 'POST',
                    body: formData
                });

                clearInterval(progressInterval);
                progressFill.style.width = '100%';
                progressText.textContent = 'Detection complete!';

                if (response.ok) {
                    const results = await response.json();
                    displayYoloResults(results);
                } else {
                    throw new Error('Detection failed');
                }

                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 1000);

            } catch (error) {
                console.error('Error processing image:', error);
                progressText.textContent = 'Error detecting elephants';
                progressContainer.style.display = 'none';
                showErrorMessage('yoloResults', 'Failed to detect elephants. Please try again.');
            }
        }

        function displayYoloResults(results) {
            const container = document.getElementById('yoloResultsList');
            const resultsContainer = document.getElementById('yoloResults');

            container.innerHTML = '';

            if (results.detections && results.detections.length > 0) {
                container.innerHTML = `
                    <div class="success-message">
                        <strong>üéØ Detection Summary:</strong> Found ${results.detections.length} elephant(s) in the image
                    </div>
                `;

                results.detections.forEach((detection, index) => {
                    const confidence = parseFloat(detection.confidence);
                    const confidenceClass = confidence > 0.8 ? 'confidence-high' :
                                          confidence > 0.6 ? 'confidence-medium' : 'confidence-low';

                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result-item';
                    resultDiv.innerHTML = `
                        <div style="flex: 1;">
                            <h5>Detection ${index + 1}</h5>
                            <p>Bounding Box: (${detection.bbox.join(', ')})</p>
                            <p>Area: ${detection.area} pixels</p>
                        </div>
                        <div class="confidence-badge ${confidenceClass}">
                            ${(confidence * 100).toFixed(1)}%
                        </div>
                    `;
                    container.appendChild(resultDiv);
                });

                if (results.annotated_image) {
                    const imgDiv = document.createElement('div');
                    imgDiv.innerHTML = `
                        <h5>üì∑ Annotated Image:</h5>
                        <img src="data:image/jpeg;base64,${results.annotated_image}" class="image-preview" alt="Detected elephants">
                    `;
                    container.appendChild(imgDiv);
                }
            } else {
                container.innerHTML = '<p>No elephants detected in the image.</p>';
            }

            resultsContainer.style.display = 'block';
        }

        // Batch Processing Functions
        function setBatchModel(model) {
            currentBatchModel = model;

            // Update UI
            document.querySelectorAll('.model-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            const modelNames = {
                'siamese': 'Siamese Network',
                'yolo': 'YOLOv8 Detection',
                'both': 'Both Models'
            };

            document.getElementById('selectedBatchModel').textContent = modelNames[model];
        }

        async function selectBatchFolder() {
            selectedFolder = await ipcRenderer.invoke('select-folder');
            if (selectedFolder) {
                document.getElementById('startBatchBtn').disabled = false;
                showSuccessMessage('batch', `Selected folder: ${selectedFolder}`);
            }
        }

        async function startBatchProcessing() {
            if (!selectedFolder) {
                showErrorMessage('batch', 'Please select a folder first.');
                return;
            }

            batchProcessing = true;
            document.getElementById('startBatchBtn').disabled = true;
            document.getElementById('stopBatchBtn').disabled = false;

            const progressContainer = document.getElementById('batchProgress');
            const progressFill = document.getElementById('batchProgressFill');
            const progressText = document.getElementById('batchProgressText');

            progressContainer.style.display = 'block';

            try {
                const formData = new FormData();
                formData.append('folder_path', selectedFolder);
                formData.append('model_type', currentBatchModel);
                formData.append('threshold', document.getElementById('batchThreshold').value);
                formData.append('max_groups', document.getElementById('batchMaxGroups').value);
                formData.append('output_format', document.getElementById('batchOutputFormat').value);

                // Start processing
                const response = await fetch('http://localhost:3001/api/process-batch', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    // Simulate progress updates
                    let progress = 0;
                    const progressInterval = setInterval(() => {
                        if (!batchProcessing) {
                            clearInterval(progressInterval);
                            return;
                        }

                        progress += Math.random() * 5;
                        if (progress > 95) progress = 95;

                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing images... ${Math.round(progress)}%`;
                    }, 1000);

                    const results = await response.json();

                    clearInterval(progressInterval);
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Batch processing complete!';

                    displayBatchResults(results);
                } else {
                    throw new Error('Batch processing failed');
                }

            } catch (error) {
                console.error('Error in batch processing:', error);
                showErrorMessage('batch', 'Batch processing failed. Please try again.');
            } finally {
                batchProcessing = false;
                document.getElementById('startBatchBtn').disabled = false;
                document.getElementById('stopBatchBtn').disabled = true;
            }
        }

        function stopBatchProcessing() {
            batchProcessing = false;
            document.getElementById('stopBatchBtn').disabled = true;
            document.getElementById('startBatchBtn').disabled = false;

            // You would need to implement actual cancellation in the backend
            showSuccessMessage('batch', 'Batch processing stopped.');
        }

        function displayBatchResults(results) {
            const container = document.getElementById('batchResultsList');
            container.innerHTML = '';

            if (results.groups && results.groups.length > 0) {
                results.groups.forEach(group => {
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'result-item';
                    groupDiv.innerHTML = `
                        <h4>ParallelGroup ${group.name}
                           <span style="font-size: 0.8em; color: #666;">(${group.size} images | Avg: ${group.confidence.toFixed(1)}%)</span>
                        </h4>
                        <div style="display: flex; gap: 10px; margin: 10px 0; flex-wrap: wrap;">
                            ${group.images.map(img => `
                                <div style="text-align: center;">
                                    <img src="data:image/jpeg;base64,${img.thumbnail}"
                                         style="width: 100px; height: 80px; object-fit: cover; border: 1px solid #ccc; border-radius: 4px;">
                                    <div style="font-size: 0.8em; color: #333;">${img.elephant_id || 'Unknown'}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(groupDiv);
                });
            } else {
                container.innerHTML = '<p>No groups found for the selected images.</p>';
            }

            resultsContainer.style.display = 'block';
        }

        async function downloadBatchResults() {
            const downloadUrl = document.getElementById('downloadResultsBtn').getAttribute('data-url');
            if (downloadUrl) {
                window.open(`http://localhost:3001${downloadUrl}`, '_blank');
            }
        }

        // Utility Functions
        function showErrorMessage(tabId, message) {
            const tab = document.getElementById(tabId);
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `<strong>‚ùå Error:</strong> ${message}`;
            tab.appendChild(errorDiv);

            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function showSuccessMessage(tabId, message) {
            const tab = document.getElementById(tabId);
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.innerHTML = `<strong>‚úÖ Success:</strong> ${message}`;
            tab.appendChild(successDiv);

            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        // Periodic model status check
        setInterval(checkModelStatus, 30000); // Check every 30 seconds
    </script>
</body>
</html>
